<!DOCTYPE html>
<html>
<head>
  <title>FB Pay Business - Secure Payment</title>
  <link rel="stylesheet" href="style.css">

  <!-- NEW CASHFREE SDK (Correct One) -->
  <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>
</head>

<body>

<div class="container">
  <h1>FB Pay Business</h1>
  <p class="subtitle">Make Secure Payments for Our Services</p>

  <form id="userForm">
      <input type="text" id="name" placeholder="Enter Customer Name" required><br>
      <input type="text" id="phone" placeholder="Enter Phone Number" required><br>
      <input type="email" id="email" placeholder="Enter Email Address" required><br>
      <input type="number" id="amount" placeholder="Enter Amount (â‚¹)" required><br>

      <button type="submit" class="btn">Proceed to Pay</button>
      <p class="note">Payments are accepted only for services listed on our website.</p>
  </form>
</div>

<footer class="footer">
  <a href="privacy.html">Privacy Policy</a>
  <a href="terms.html">Terms & Conditions</a>
  <a href="refund.html">Refund Policy</a>
</footer>


<script>
document.getElementById("userForm").onsubmit = async function(e){
    e.preventDefault();

    const userData = {
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        email: document.getElementById("email").value,
        amount: document.getElementById("amount").value
    };

    // Save user data for success page
    localStorage.setItem("paymentUser", JSON.stringify(userData));

    // Create order from backend
    let order = await fetch("https://fb-pay-business-backend.onrender.com/create-order", {

        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(userData)
    });

    order = await order.json();

    console.log("ORDER RESPONSE:", order);

    if (!order.payment_session_id) {
        alert("Payment session failed. Check backend console.");
        return;
    }

    // Initialize Cashfree Checkout
    const cashfree = Cashfree({ mode: "sandbox" });

    cashfree.checkout({
        paymentSessionId: order.payment_session_id,
        redirectTarget: "_self"
    });
};
</script>

</body>
</html>
